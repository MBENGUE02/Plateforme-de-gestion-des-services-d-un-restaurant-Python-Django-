{% extends 'composants/base.html' %}
{% load static %}
{% block title %}Mon Historique - Al Mountakha{% endblock %}

{% block content %}
<section id="historique" class="section" style="padding-top: 200px;">
  <div class="container section-title" data-aos="fade-up">
    <h2>MON HISTORIQUE</h2>
    <p>Retrouvez vos commandes et réservations passées</p>
  </div>

  <div class="container">
    <div class="row gy-4">

      <!-- Commandes -->
      <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
        <div class="card-item">
          <span>01</span>
          <h4>Commandes</h4>
          {% if commandes %}
            <ul class="list-group mt-3">
              {% for commande in commandes %}
                <li class="list-group-item d-flex justify-content-between align-items-start">
                  <div>
                    <strong>Commande du {{ commande.date_commande|date:"d/m/Y H:i" }}</strong><br>
                    {% with commande.statut.code as code %}
                      {% if code == 'livree' %}
                        <span class="badge bg-success">Livrée</span>
                      {% elif code == 'en_cours' %}
                        <span class="badge bg-warning text-dark">En cours</span>
                      {% elif code == 'annulee' %}
                        <span class="badge bg-danger">Annulée</span>
                      {% else %}
                        <span class="badge bg-secondary">{{ commande.statut.libelle }}</span>
                      {% endif %}
                    {% endwith %}
                  </div>
                  <span class="badge bg-success rounded-pill">#{{ commande.id }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="mt-3">Aucune commande enregistrée.</p>
          {% endif %}
        </div>
      </div>

      <!-- Réservations -->
      <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
        <div class="card-item">
          <span>02</span>
          <h4>Réservations</h4>
          {% if reservations %}
            <ul class="list-group mt-3">
              {% for reservation in reservations %}
                <li class="list-group-item d-flex justify-content-between align-items-start">
                  <div>
                    <strong>Réservation du {{ reservation.date_reservation|date:"d/m/Y" }} à {{ reservation.heure|time:"H:i" }}</strong><br>
                    {% if reservation.statut == 'confirmee' %}
                      <span class="badge bg-success">Confirmée</span>
                    {% elif reservation.statut == 'annulee' %}
                      <span class="badge bg-danger">Annulée</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">En attente</span>
                    {% endif %}
                  </div>
                  <span class="badge bg-primary rounded-pill">#{{ reservation.id }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="mt-3">Aucune réservation enregistrée.</p>
          {% endif %}
        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}
